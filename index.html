<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>mapMD</title>
</head>
<script src="pixi.js"></script>
<body>
<style>* {
    padding: 0;
    margin: 0
}</style>
<script type="text/javascript">
    //Create the renderer

    const data = {
        leftEye: [],
        rightEye: []
    }

    const Graphics = PIXI.Graphics;

    const renderer = PIXI.autoDetectRenderer(
        0, 0,
        {antialias: false, transparent: false, resolution: 1}
    );

    renderer.view.style.position = "absolute";
    renderer.view.style.display = "block";
    renderer.autoResize = true;
    renderer.resize(window.innerWidth, window.innerHeight);

    renderer.backgroundColor = 0xfffff;

    //Add the canvas to the HTML document
    document.body.appendChild(renderer.view);

    //Create a container object called the `stage`
    const stage = new PIXI.Container();

    const leftRectangle = new Graphics();
    leftRectangle.beginFill(0xFFFFFF);
    leftRectangle.drawRect(0, 0, renderer.width / 2, renderer.height);
    leftRectangle.endFill();
    stage.addChild(leftRectangle);

    const leftCircle = new Graphics();
    leftCircle.beginFill(0x9966FF);
    leftCircle.drawCircle(0, 0, 32);
    leftCircle.endFill();
    leftRectangle.addChild(leftCircle);

    const leftMask = new Graphics();
    leftMask.drawRect(0, 0, renderer.width / 2, renderer.height);
    leftCircle.mask = leftMask;

    const rightRectangle = new Graphics();
    rightRectangle.beginFill(0x000000);
    rightRectangle.drawRect(renderer.width / 2, 0, renderer.width / 2, renderer.height);
    rightRectangle.endFill();
    stage.addChild(rightRectangle);

    const rightCircle = new Graphics();
    rightCircle.beginFill(0x99999);
    rightCircle.drawCircle(renderer.width / 2, 0, 32);
    rightCircle.endFill();
    rightRectangle.addChild(rightCircle);

    const rightMask = new Graphics();
    rightMask.drawRect(renderer.width / 2, 0, renderer.width / 2, renderer.height);
    rightCircle.mask = rightMask;

    renderer.render(stage);

    function randomPosition(isLeft) {
        if (isLeft) {
            return [Math.random() * renderer.width / 2, Math.random() * renderer.height]
        } else {
            return [Math.random() * renderer.width / 2, Math.random() * renderer.height]
        }
    }

    let showFrequency = 2 * 60;
    let variation = 0;
    let variationMax = 3 * 60;
    let displayFor = 60;
    let counter = 0;

    let hits = 0;


    //    leftRectangle.mask = leftCircle;
    //    rightRectangle.mask = rightCircle;

    function gameLoop() {

        //Loop this function 60 times per second
        requestAnimationFrame(gameLoop);

        //Move the cat 1 pixel per frame
        if (showFrequency == counter) {
            showLeftOrRight();
            [leftCircle.x, leftCircle.y] = randomPosition();
            [rightCircle.x, rightCircle.y] = randomPosition();
            counter = 0;
            variation = getVariation();
        } else if (displayFor == counter) {
            hideCircles();
            counter++;
        } else {
            counter++;
        }

        //Render the stage
        renderer.render(stage);
    }

    function hideCircles() {
        leftCircle.visible = false;
        rightCircle.visible = false;
    }

    function showLeftOrRight() {
        if (Math.random() > .5) {
            leftCircle.visible = true;
        } else {
            rightCircle.visible = true;
        }
    }

    function getVariation() {
        return Math.random() * variationMax;
    }

    hideCircles();

    gameLoop();


</script>
</body>
</html>