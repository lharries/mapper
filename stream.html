<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="mobile-web-app-capable" content="yes">
    <title>mapMD</title>
</head>
<script src="pixi.js"></script>
<script src="js/tools/webcam.js"></script>
<script src="js/tools/tools.js"></script>
<script src="js/tools/ColorMapFilter.js"></script>
<script src="js/tools/webcam.js"></script>
<body>
<style>* {
    padding: 0;
    margin: 0;
    height: 100%;

}
</style>
<script type="text/javascript">
    //Create the renderer
    var stage = new PIXI.Container(),
        renderer = PIXI.autoDetectRenderer(0, 0);
    document.body.appendChild(renderer.view);

    renderer.view.style.position = "absolute";
    renderer.view.style.display = "block";
    renderer.autoResize = true;
    renderer.resize(window.innerWidth, window.innerHeight);

    //Use Pixi's built-in `loader` object to load an image
//    PIXI.loader
//            .add("img_fjords.jpg")
//            .load(setup);

    //This `setup` function will run when the image has loaded

    const webcam = new Webcam();
    webcam.onReady.add(onWebcam);
    webcam.init();

    function setup() {

//        //Create the `cat` sprite from the texture
//        var cat = new PIXI.Sprite(
//            PIXI.loader.resources["img_fjords.jpg"].texture
//        );
//
//        //Add the cat to the stage
//        stage.addChild(cat);

        //Render the stage
        renderer.render(stage);
    }

    let texture;
    let sprite;

    function onWebcam() {
        console.log('webcam loaded');
        console.log(webcam.video);
        texture = new PIXI.Texture.fromVideo(webcam.video);
        sprite = new PIXI.Sprite(texture);

        sprite.x = 0;
        sprite.y = 0;
        sprite.height = renderer.height;
        sprite.width = renderer.width;

        stage.addChild(sprite);

        renderer.render(stage);

        loop();

//        requestAnimationFrame(loop);

    }

    function loop() {
        setTimeout(loop, 50);

        sprite.texture.update();
        setTimeout(() => loop(), 20);
        console.log('loop');
        renderer.render(stage);
    }

    setup();
</script>
</body>
</html>